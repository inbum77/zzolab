import streamlit as st
import base64
from PIL import Image, ImageDraw, ImageFont
from io import BytesIO

# 텍스트로 이미지 생성하는 함수
def create_text_image(name, bgColor=(240, 240, 240), textColor=(0, 0, 0), size=(200, 200)):
    img = Image.new('RGB', size, color=bgColor)
    draw = ImageDraw.Draw(img)
    
    # 텍스트 중앙에 배치
    text = name
    text_width = draw.textlength(text, font=None)
    text_position = ((size[0] - text_width) / 2, size[1] / 2 - 10)
    
    # 텍스트 그리기
    draw.text(text_position, text, fill=textColor)
    
    return img

# 이미지를 base64로 인코딩하여 표시하는 함수
def get_image_base64(img):
    buffered = BytesIO()
    img.save(buffered, format="JPEG")
    img_str = base64.b64encode(buffered.getvalue()).decode()
    return img_str

# 캐릭터 이미지 생성 함수 (각 MBTI별 특색 있는 색상 사용)
def get_character_image(name, mbti_type):
    # MBTI 유형별 색상 매핑
    color_map = {
        "INTJ": (75, 0, 130),   # 보라색 - 분석가
        "INTP": (0, 0, 139),    # 짙은 파란색 - 사색가
        "INFJ": (147, 112, 219), # 라벤더색 - 예언자
        "INFP": (221, 160, 221), # 연보라색 - 중재자
        "ENTJ": (178, 34, 34),  # 적갈색 - 통솔자
        "ENTP": (255, 69, 0),   # 주황빨간색 - 발명가
        "ENFJ": (255, 20, 147), # 핫핑크 - 선도자
        "ENFP": (255, 105, 180), # 분홍색 - 활동가
        "ISTJ": (47, 79, 79),   # 짙은 회색 - 실무자
        "ISTP": (105, 105, 105), # 회색 - 장인
        "ISFJ": (107, 142, 35), # 올리브색 - 수호자
        "ISFP": (154, 205, 50), # 연두색 - 탐험가
        "ESTJ": (0, 100, 0),    # 짙은 녹색 - 경영자
        "ESTP": (34, 139, 34),  # 녹색 - 기업가
        "esfj": (70, 130, 180), # 강철 파란색 - 집정관
        "ESFP": (30, 144, 255)  # 하늘색 - 연예인
    }
    
    # 해당 MBTI 색상 가져오기 (기본값은 회색)
    bg_color = color_map.get(mbti_type, (200, 200, 200))
    
    # 텍스트 색상은 배경 색상이 어두우면 밝게, 밝으면 어둡게
    brightness = (bg_color[0] * 299 + bg_color[1] * 587 + bg_color[2] * 114) / 1000
    text_color = (255, 255, 255) if brightness < 128 else (0, 0, 0)
    
    return create_text_image(name, bg_color, text_color)

mbti_info = {
    "INTJ": {
        "성격": "전략적이고 독립적인 사고를 좋아하는 분석가예요 🧠📊",
        "장점": ["계획적임 ✅", "문제 해결에 능함 🛠️", "자기 주도적임 🚀"],
        "단점": ["완벽주의 성향 😵", "감정을 잘 드러내지 않음 😐", "융통성이 부족할 수 있음 🔒"],
        "장점_팁": "계획적인 면을 살려 프로젝트를 주도해보세요! 💼✨",
        "단점_팁": "감정을 나누고, 유연하게 대처하는 연습을 해보세요 🌿🗣️",
        "연예인": [
            "엘론 머스크",
            "아이유"
        ]
    },
    "INTP": {
        "성격": "호기심 많고 분석적인 철학자예요 🤓🔍",
        "장점": ["창의적 🎨", "논리적 사고 🧠", "독립적 🧍‍♂️"],
        "단점": ["현실 감각 부족 🌫️", "감정 표현 어려움 😶"],
        "장점_팁": "복잡한 문제 해결 능력을 연구나 기획에 활용해보세요! 🧪",
        "단점_팁": "소통을 통해 아이디어를 현실과 연결해보세요. 💬🔗",
        "연예인": [
            "앨버트 아인슈타인",
            "공유"
        ]
    },
    "INFJ": {
        "성격": "통찰력 있고 이상주의적인 조언자예요 🔮💬",
        "장점": ["깊은 공감 능력 ❤️", "통찰력 👁️", "도움 주기를 좋아함 🤝"],
        "단점": ["내향적 경향 🤐", "감정 기복 📉"],
        "장점_팁": "타인을 이해하고 돕는 능력을 상담이나 교육 분야에 살려보세요 🎓",
        "단점_팁": "스스로의 감정을 관리하며 자기 돌봄을 잊지 마세요 🌸",
        "연예인": [
            "칼 융",
            "정해인"
        ]
    },
    "INFP": {
        "성격": "이상과 가치를 중시하는 낭만주의자예요 🌈📚",
        "장점": ["창의적 🎭", "이타적 💖", "깊은 내면의 성찰 🤔"],
        "단점": ["현실 도피 경향 🕳️", "결단력 부족 😓"],
        "장점_팁": "예술, 문학, 봉사활동 등 가치 있는 활동으로 표현해보세요 🎨",
        "단점_팁": "작은 결정부터 실천하며 현실감을 키워보세요 🪴",
        "연예인": [
            "윌리엄 셰익스피어",
            "태연"
        ]
    },
    "ENTJ": {
        "성격": "리더십 있고 추진력 강한 통솔자예요 👑⚡",
        "장점": ["결단력 💪", "목표 지향적 🎯", "통솔력 👍"],
        "단점": ["지나치게 경쟁적 🔥", "감정에 무관심할 수 있음 😶"],
        "장점_팁": "조직을 이끄는 리더 역할에서 진가를 발휘해보세요 🏢",
        "단점_팁": "주변 사람들의 감정을 살피고 배려하는 연습을 해보세요 🤗",
        "연예인": [
            "마거릿 대처",
            "김혜수"
        ]
    },
    "ENTP": {
        "성격": "호기심 많고 논쟁을 즐기는 혁신가예요 💭🔍",
        "장점": ["창의적 💡", "논리적 🧩", "적응력 있음 🐬"],
        "단점": ["규칙을 싫어함 🚫", "집중력 부족 📢", "논쟁적 🔥"],
        "장점_팁": "창의성과 논리력을 새로운 시스템 개발에 활용해보세요 🚀",
        "단점_팁": "중요한 일에 에너지를 집중하고 타인의 의견도 존중해보세요 🎯",
        "연예인": [
            "마크 트웨인",
            "이영자"
        ]
    },
    "ENFP": {
        "성격": "에너지 넘치고 창의적인 열정가예요 🌟🎉",
        "장점": ["사교적 🗣️", "긍정적 🌞", "아이디어 풍부 💡"],
        "단점": ["산만할 수 있음 🌀", "계획 부족 📆❌"],
        "장점_팁": "다양한 사람과의 소통에서 창의력을 발휘해보세요 🎭",
        "단점_팁": "일정을 정리하고 목표를 설정해 집중력을 높여보세요 📋🖊️",
        "연예인": [
            "로버트 다우니 주니어",
            "유재석"
        ]
    },
    "ENFJ": {
        "성격": "따뜻하고 열정적인 리더예요 🔥🤝",
        "장점": ["카리스마 있음 ✨", "공감 능력 뛰어남 ❤️", "조직적 🗂️"],
        "단점": ["자기 희생적 경향 😓", "완벽주의 📏"],
        "장점_팁": "조직 내 리더로서 팀원과 조화를 이루어보세요 🧑‍🤝‍🧑",
        "단점_팁": "자신을 돌보는 시간을 확보하세요 🧘‍♀️",
        "연예인": [
            "바락 오바마",
            "박보영"
        ]
    },
    "ESTJ": {
        "성격": "실용적이고 책임감 강한 관리자예요 📋🔧",
        "장점": ["체계적 📊", "현실적 🧱", "리더십 강함 🧭"],
        "단점": ["융통성 부족 🔒", "감정에 둔감할 수 있음 😐"],
        "장점_팁": "업무 관리와 책임 있는 역할에서 강점을 발휘해보세요 🛠️",
        "단점_팁": "다른 의견을 존중하고 융통성을 길러보세요 🌈",
        "연예인": [
            "저지 주디",
            "이순재"
        ]
    },
    "ESTP": {
        "성격": "행동력 있고 모험적인 사업가예요 🏄‍♂️💼",
        "장점": ["실용적 🛠️", "적응력 있음 🦎", "행동력 강함 🚀"],
        "단점": ["인내심 부족 ⏱️", "계획성 부족 📝❌"],
        "장점_팁": "위기 대처능력과 실행력을 살려 도전적인 일에 도전해보세요 🏆",
        "단점_팁": "장기적 목표를 세우고 꾸준히 추진해보세요 🌱",
        "연예인": [
            "도널드 트럼프",
            "이수근"
        ]
    },
    "ESFP": {
        "성격": "자유롭고 즉흥적인 연예인 기질이에요 🎭✨",
        "장점": ["사교적 🥂", "에너지 넘침 ⚡", "긍정적 🌈"],
        "단점": ["충동적 🎯", "계획성 부족 📅❌"],
        "장점_팁": "사람들과 어울리며 예술적 재능을 발휘해보세요 🎨",
        "단점_팁": "중요한 결정 전에 충분히 생각하는 습관을 들여보세요 🤔",
        "연예인": [
            "마릴린 먼로",
            "이효리"
        ]
    },
    "ESFJ": {
        "성격": "인기 많고 세심한 사교가예요 🥰👋",
        "장점": ["협조적 🤝", "조직적 📋", "사람 관계에 능함 👥"],
        "단점": ["비판에 민감함 😢", "지나친 동조 경향 👍"],
        "장점_팁": "사람들을 모으고 돌보는 능력을 살려보세요 💐",
        "단점_팁": "자신의 의견도 소중히 여기고 표현하는 연습을 해보세요 🗣️",
        "연예인": [
            "테일러 스위프트",
            "전현무"
        ]
    },
    "ISTJ": {
        "성격": "신중하고 책임감 있는 현실주의자예요 📝🧮",
        "장점": ["믿음직함 🤞", "체계적 📊", "꼼꼼함 🔍"],
        "단점": ["변화를 꺼림 🔄❌", "융통성 부족 🚧"],
        "장점_팁": "세부 사항을 꼼꼼히 살피는 능력을 업무에 활용해보세요 📋",
        "단점_팁": "작은 변화부터 시도하며 적응력을 키워보세요 🌱",
        "연예인": [
            "퀸 엘리자베스 2세",
            "신동엽"
        ]
    },
    "ISTP": {
        "성격": "조용하고 분석적인 기술자예요 🔧🔍",
        "장점": ["실용적 🛠️", "적응력 강함 🦎", "문제해결 능력 🧩"],
        "단점": ["감정표현 부족 😶", "장기적 계획 어려움 🗓️"],
        "장점_팁": "기술적 문제를 해결하는 능력을 살려보세요 ⚙️",
        "단점_팁": "감정을 표현하고 장기적 목표를 세워보세요 🎯",
        "연예인": [
            "클린트 이스트우드",
            "현빈"
        ]
    },
    "ISFP": {
        "성격": "감성적이고 예술적인 모험가예요 🎨🦋",
        "장점": ["창의적 🖌️", "감성이 풍부함 💝", "평화로움 🕊️"],
        "단점": ["경쟁을 피함 🏆❌", "계획성 부족 📆"],
        "장점_팁": "예술적 감각을 디자인이나 음악 등에 활용해보세요 🎵",
        "단점_팁": "작은 목표를 세우고 성취감을 맛보세요 ✅",
        "연예인": [
            "마이클 잭슨",
            "박서준"
        ]
    },
    "ISFJ": {
        "성격": "따뜻하고 헌신적인 수호자예요 🛡️🧸",
        "장점": ["배려심 깊음 💕", "책임감 있음 📋", "꼼꼼함 🔍"],
        "단점": ["변화를 두려워함 🔄😨", "자기주장 부족 🤐"],
        "장점_팁": "세심함과 배려심을 교육, 의료 등 돌봄 분야에 활용해보세요 🏥",
        "단점_팁": "자신의 의견을 표현하고 새로운 경험을 시도해보세요 🌈",
        "연예인": [
            "케이트 미들턴",
            "수지"
        ]
    }
}

st.set_page_config(page_title="MBTI 성격 분석기", page_icon="🧬")
st.title("🧬 MBTI 성격 분석기")
st.markdown("MBTI를 선택하면 당신의 성격, 장점과 단점, 팁, 그리고 같은 유형의 연예인을 알려드릴게요! 😄")

selected_mbti = st.selectbox("👉 당신의 MBTI를 선택하세요!", list(mbti_info.keys()))

if selected_mbti:
    info = mbti_info[selected_mbti]

    st.subheader(f"📌 {selected_mbti}의 성격")
    st.write(info["성격"])

    st.subheader("👍 장점")
    for good in info["장점"]:
        st.markdown(f"- {good}")
    st.markdown(f"💡 **장점을 살리는 방법**: {info['장점_팁']}")

    st.subheader("👎 단점")
    for bad in info["단점"]:
        st.markdown(f"- {bad}")
    st.markdown(f"🛠️ **단점을 줄이는 방법**: {info['단점_팁']}")

    st.subheader("🌟 같은 MBTI 연예인")
    col1, col2 = st.columns(2)
    
    for i, name in enumerate(info["연예인"]):
        # 이름으로 이미지 생성
        img = get_character_image(name, selected_mbti)
        
        if i % 2 == 0:
            with col1:
                # 이미지를 base64로 표시
                img_str = get_image_base64(img)
                st.markdown(f"""
                <div style="text-align: center; border-radius: 10px; overflow: hidden; 
                            background-color: #f0f0f0; padding: 10px;">
                    <img src="data:image/jpeg;base64,{img_str}" style="width: 100%; border-radius: 10px;">
                    <p style="margin-top: 8px; font-weight: bold;">🎬 {name}</p>
                </div>
                """, unsafe_allow_html=True)
        else:
            with col2:
                # 이미지를 base64로 표시
                img_str = get_image_base64(img)
                st.markdown(f"""
                <div style="text-align: center; border-radius: 10px; overflow: hidden; 
                            background-color: #f0f0f0; padding: 10px;">
                    <img src="data:image/jpeg;base64,{img_str}" style="width: 100%; border-radius: 10px;">
                    <p style="margin-top: 8px; font-weight: bold;">🎬 {name}</p>
                </div>
                """, unsafe_allow_html=True)
